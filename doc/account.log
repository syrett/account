-- 专门作为数据库修改记录，具体数据库结构请看manage项目
-- stock 添加销售字段 订单号 order_no_sale
-- 添加了数据库表 product 销售 purchase 采购 stock 货品 bank 银行 cash 现金，

CREATE TABLE IF NOT EXISTS `bank` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `target` varchar(512) DEFAULT NULL COMMENT '交易对象',
  `date` varchar(64) DEFAULT NULL COMMENT '日期',
  `memo` text COMMENT '说明',
  `amount` float NOT NULL COMMENT '金额',
  `parent` int(11) DEFAULT NULL COMMENT '父，相关',
  `order` text COMMENT '订单号',
  `subject` varchar(16) DEFAULT NULL COMMENT '科目',
  `subject_2` int(12) DEFAULT NULL,
  `invoice` tinyint(4) DEFAULT '0' COMMENT '有无发票',
  `tax` int(8) DEFAULT NULL COMMENT '税率',
  `status_id` tinyint(4) NOT NULL DEFAULT '0' COMMENT '1:已经生成凭证 ',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `status_id` (`status_id`),
  KEY `created_at` (`created_at`),
  KEY `updated_at` (`updated_at`),
  KEY `parent` (`parent`),
  KEY `sbj_bank` (`subject_2`),
  KEY `sbj_bank_2` (`subject_2`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=378 ;

-- --------------------------------------------------------

--
-- 表的结构 `cash`
--

CREATE TABLE IF NOT EXISTS `cash` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `target` varchar(512) DEFAULT NULL COMMENT '交易对象',
  `date` varchar(64) DEFAULT NULL COMMENT '日期',
  `memo` text COMMENT '说明',
  `amount` float NOT NULL COMMENT '金额',
  `parent` int(11) DEFAULT NULL COMMENT '父，相关',
  `order` text COMMENT '订单号',
  `subject` varchar(16) DEFAULT NULL COMMENT '科目',
  `subject_2` int(12) DEFAULT NULL,
  `invoice` tinyint(4) DEFAULT '0' COMMENT '有无发票',
  `tax` int(8) DEFAULT NULL COMMENT '税率',
  `status_id` tinyint(4) NOT NULL DEFAULT '0' COMMENT '1:已经生成凭证 ',
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` int(11) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `status_id` (`status_id`),
  KEY `created_at` (`created_at`),
  KEY `updated_at` (`updated_at`),
  KEY `parent` (`parent`),
  KEY `sbj_bank` (`subject_2`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;

CREATE TABLE IF NOT EXISTS `product` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `order_no` int(11) NOT NULL COMMENT '订单号',
  `saled_date` int(11) NOT NULL COMMENT '销售日期',
  `client_id` int(11) NOT NULL COMMENT '客户ID',
  `product` varchar(512) NOT NULL COMMENT '商品名称',
  `price` float NOT NULL COMMENT '价格',
  `amount` int(11) NOT NULL,
  `unit` varchar(32) NOT NULL COMMENT '单位',
  `tax` int(11) NOT NULL COMMENT '税率',
  `paied` float NOT NULL COMMENT '已收金额',
  `subject` int(11) DEFAULT NULL,
  `subject_2` int(11) DEFAULT NULL,
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` int(11) NOT NULL,
  `status_id` tinyint(4) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `client_id` (`client_id`),
  KEY `subject_2` (`subject_2`),
  KEY `subject` (`subject`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;

-- --------------------------------------------------------

--
-- 表的结构 `purchase`
--

CREATE TABLE IF NOT EXISTS `purchase` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `order_no` varchar(16) NOT NULL COMMENT '订单号',
  `entry_date` varchar(16) NOT NULL COMMENT '采购日期',
  `vendor_id` int(11) NOT NULL COMMENT '供应商ID',
  `entry_name` varchar(512) NOT NULL COMMENT '商品名称',
  `entry_memo` varchar(1024) DEFAULT NULL,
  `price` float NOT NULL COMMENT '价格',
  `count` int(11) NOT NULL DEFAULT '1',
  `unit` varchar(32) DEFAULT NULL COMMENT '单位',
  `tax` int(11) NOT NULL COMMENT '税率',
  `paied` float NOT NULL COMMENT '已付金额',
  `subject` int(11) DEFAULT NULL,
  `subject_2` int(11) DEFAULT NULL,
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` int(11) NOT NULL,
  `status_id` tinyint(4) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `vendor_id` (`vendor_id`),
  KEY `subject` (`subject`,`subject_2`),
  KEY `subject_2` (`subject_2`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=6 ;

-- --------------------------------------------------------

--
-- 表的结构 `stock`
--

CREATE TABLE IF NOT EXISTS `stock` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `no` varchar(64) NOT NULL COMMENT '编号',
  `order_no` varchar(16) NOT NULL COMMENT '采购订单',
  `order_no_sale` varchar(16) NOT NULL COMMENT '销售订单',
  `name` varchar(512) NOT NULL COMMENT '名字',
  `vendor_id` int(11) DEFAULT NULL COMMENT '供应商',
  `client_id` int(11) DEFAULT NULL COMMENT '销售动向，客户ID',
  `in_date` varchar(16) NOT NULL COMMENT '日期',
  `in_price` float NOT NULL COMMENT '价格',
  `out_date` timestamp NULL DEFAULT NULL,
  `out_price` float DEFAULT NULL,
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `status` tinyint(4) NOT NULL DEFAULT '1' COMMENT '1:正常，2出库，3退货',
  PRIMARY KEY (`id`),
  KEY `vendor_id` (`vendor_id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=26 ;

-- transition 添加字段
alter table `transition`
  ADD COLUMN `data_type` varchar(16) default NULL COMMENT '类型' after `entry_date`,
  ADD COLUMN `data_id` int(11) NOT NULL COMMENT '原始数据ID' after `entry_date`,
  ADD COLUMN `entry_name` varchar(512) NOT NULL COMMENT '交易方名称' after `entry_date`;

-- employee 添加职位字段
alter table `employee`
    ADD COLUMN `position` varchar(32) default NULL Comment '职位' after department_id;

-- 添加视图
DROP TABLE IF EXISTS `condomdate`;

CREATE ALGORITHM=UNDEFINED SQL SECURITY DEFINER VIEW `condomdate` AS select max(`transition`.`entry_num_prefix`) AS `date` from `transition` where (`transition`.`entry_closing` = 1);

-- 添加表关系

ALTER TABLE `product`
  ADD CONSTRAINT `product_ibfk_1` FOREIGN KEY (`client_id`) REFERENCES `client` (`id`),
  ADD CONSTRAINT `product_ibfk_2` FOREIGN KEY (`subject`) REFERENCES `subjects` (`sbj_number`),
  ADD CONSTRAINT `product_ibfk_3` FOREIGN KEY (`subject_2`) REFERENCES `subjects` (`sbj_number`);

--
-- 限制表 `purchase`
--
ALTER TABLE `purchase`
  ADD CONSTRAINT `purchase_ibfk_1` FOREIGN KEY (`vendor_id`) REFERENCES `vendor` (`id`),
  ADD CONSTRAINT `purchase_ibfk_2` FOREIGN KEY (`subject`) REFERENCES `subjects` (`sbj_number`),
  ADD CONSTRAINT `purchase_ibfk_3` FOREIGN KEY (`subject_2`) REFERENCES `subjects` (`sbj_number`);

--
-- 限制表 `stock`
--
ALTER TABLE `stock`
  ADD CONSTRAINT `stock_ibfk_1` FOREIGN KEY (`vendor_id`) REFERENCES `vendor` (`id`) ON DELETE SET NULL,
  ADD CONSTRAINT `stock_ibfk_2` FOREIGN KEY (`client_id`) REFERENCES `client` (`id`) ON DELETE SET NULL;
--
-- 限制表 `bank`
--
ALTER TABLE `bank`
  ADD CONSTRAINT `bank_ibfk_1` FOREIGN KEY (`subject_2`) REFERENCES `subjects` (`sbj_number`);

--
-- 限制表 `cash`
--
ALTER TABLE `cash`
  ADD CONSTRAINT `cash_ibfk_1` FOREIGN KEY (`subject_2`) REFERENCES `subjects` (`sbj_number`);

-- 2015年7月22日19:44:15
-- stock 添加entry_subject cost_role成本计算方法
ALTER TABLE `stock` ADD `entry_subject` INT NULL AFTER `name`;
ALTER TABLE `stock` ADD `cost_role` INT NULL COMMENT '成本计算方法' AFTER `create_time`;
ALTER TABLE `stock` ADD FOREIGN KEY (`entry_subject`) REFERENCES `subjects`(`sbj_number`) ON DELETE RESTRICT ON UPDATE RESTRICT;

-- 新建表cost，成本结转


CREATE TABLE IF NOT EXISTS `cost` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `order_no` varchar(16) NOT NULL COMMENT '订单号',
  `entry_date` varchar(16) NOT NULL COMMENT '销售日期',
  `entry_name` varchar(512) NOT NULL COMMENT '商品名称',
  `stocks` varchar(512) NOT NULL COMMENT '商品清单',
  `stocks_count` varchar(512) NOT NULL COMMENT '对应数量',
  `stocks_price` varchar(512) NOT NULL COMMENT '对应当时计算价格',
  `entry_amount` float NOT NULL COMMENT '成本',
  `subject` int(11) DEFAULT NULL,
  `subject_2` varchar(11) DEFAULT NULL,
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` int(11) NOT NULL,
  `status_id` tinyint(4) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `subject_2` (`subject_2`),
  KEY `subject` (`subject`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1;

--
-- 限制表 `cost`
--
ALTER TABLE `cost`
  ADD CONSTRAINT `cost_ibfk_2` FOREIGN KEY (`subject`) REFERENCES `subjects` (`sbj_number`) ON DELETE NO ACTION;
-- bank cash 添加 订单号字段
ALTER TABLE `bank` ADD `order_no` VARCHAR(16) NULL after id;
ALTER TABLE `cash` ADD `order_no` VARCHAR(16) NULL after id;



-- 2015年7月28日13:55:16
ALTER TABLE `purchase` ADD `department_id` INT NULL COMMENT '如果是公司自己使用，比如固定资产，需要填写部门' AFTER `entry_memo`;
ALTER TABLE `purchase` ADD INDEX(`department_id`);
ALTER TABLE `purchase` ADD FOREIGN KEY (`department_id`) REFERENCES `department`(`id`) ON DELETE RESTRICT ON UPDATE RESTRICT;
-- 修改stock表 字段，固定资产编码
ALTER TABLE `stock` CHANGE `no` `hs_no` VARCHAR(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '编号';

ALTER TABLE `cost` CHANGE `subject_2` `subject_2` VARCHAR(11) NULL DEFAULT NULL;
ALTER TABLE `options` CHANGE `entrynum` `value` FLOAT NOT NULL DEFAULT '0';
ALTER TABLE `options` CHANGE `id` `id` INT(11) NOT NULL AUTO_INCREMENT;
ALTER TABLE `options` ADD `entry_subject` INT(16) NOT NULL AFTER `id`;
DELETE FROM `options` WHERE 1;
ALTER TABLE `options` ADD INDEX(`entry_subject`);
ALTER TABLE `options` ADD FOREIGN KEY (`entry_subject`) REFERENCES `subjects`(`sbj_number`) ON DELETE RESTRICT ON UPDATE RESTRICT;
ALTER TABLE `options` CHANGE `url` `year` INT(16) NOT NULL DEFAULT 0 COMMENT '折旧或摊销年限';
ALTER TABLE `stock` ADD `worth` FLOAT NULL COMMENT '净值' AFTER `out_price`;
alter table options drop primary key;
ALTER TABLE `options` ADD PRIMARY KEY(`entry_subject`);
ALTER TABLE `stock` CHANGE `in_price` `in_price` DECIMAL(12,2) NOT NULL COMMENT '价格', CHANGE `out_price` `out_price` DECIMAL(12,2) NULL DEFAULT NULL, CHANGE `worth` `worth` DECIMAL(12,2) NULL DEFAULT NULL COMMENT '净值';


-- 2015年8月4日14:58:22
CREATE TABLE IF NOT EXISTS `salary` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `order_no` varchar(16) NOT NULL COMMENT '订单号',
  `entry_date` varchar(16) NOT NULL COMMENT '销售日期',
  `employee_id` int(11) NOT NULL COMMENT '员工ID',
  `salary_amount` decimal(12,2) NOT NULL COMMENT '工资',
  `bonus_amount` decimal(12,2) NOT NULL COMMENT '奖金',
  `benefit_amount` decimal(12,2) NOT NULL COMMENT '其他福利',
  `base_amount` decimal(12,2) DEFAULT NULL COMMENT '当时社保基数',
  `social_personal` decimal(12,2) DEFAULT NULL COMMENT '社保个人部分',
  `provident_personal` decimal(12,2) DEFAULT NULL COMMENT '公积金个人部分',
  `personal_tax` decimal(12,2) DEFAULT NULL COMMENT '个人所得税',
  `social_company` decimal(12,2) DEFAULT NULL COMMENT '社保公司部分',
  `provident_company` decimal(12,2) DEFAULT NULL COMMENT '公积金公司部分',
  `subject` int(11) DEFAULT NULL,
  `subject_2` varchar(512) DEFAULT NULL,
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` int(11) NOT NULL,
  `status_id` tinyint(4) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `subject_2` (`subject_2`(255)),
  KEY `subject` (`subject`),
  KEY `employee_id` (`employee_id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;

CREATE TABLE IF NOT EXISTS `reimburse` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `order_no` varchar(16) NOT NULL COMMENT '订单号',
  `entry_date` varchar(16) NOT NULL COMMENT '销售日期',
  `entry_memo` varchar(1024) DEFAULT NULL COMMENT '摘要',
  `employee_id` int(11) NOT NULL COMMENT '员工ID',
  `travel_amount` decimal(12,2) DEFAULT NULL COMMENT '差旅费',
  `benefit_amount` decimal(12,2) DEFAULT NULL COMMENT '福利费（餐费等）',
  `traffic_amount` decimal(12,2) DEFAULT NULL COMMENT '交通费',
  `phone_amount` decimal(12,2) DEFAULT NULL COMMENT '通讯费',
  `entertainment_amount` decimal(12,2) DEFAULT NULL COMMENT '招待费',
  `office_amount` decimal(12,2) DEFAULT NULL COMMENT '办公费',
  `rent_amount` decimal(12,2) DEFAULT NULL COMMENT '租金',
  `watere_amount` decimal(12,2) DEFAULT NULL COMMENT '水电费',
  `train_amount` decimal(12,2) DEFAULT NULL COMMENT '培训费',
  `service_amount` decimal(12,2) DEFAULT NULL COMMENT '服务费',
  `stamping_amount` decimal(12,2) DEFAULT NULL COMMENT '印花税',
  `subject` int(11) DEFAULT NULL,
  `subject_2` varchar(11) DEFAULT NULL,
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` int(11) NOT NULL,
  `status_id` tinyint(4) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `subject_2` (`subject_2`),
  KEY `subject` (`subject`),
  KEY `employee_id` (`employee_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;

ALTER TABLE `reimburse`
  ADD CONSTRAINT `reimburse_ibfk_1` FOREIGN KEY (`employee_id`) REFERENCES `employee` (`id`),
  ADD CONSTRAINT `reimburse_ibfk_2` FOREIGN KEY (`subject`) REFERENCES `subjects` (`sbj_number`);

ALTER TABLE `salary`
  ADD CONSTRAINT `salary_ibfk_1` FOREIGN KEY (`subject`) REFERENCES `subjects` (`sbj_number`),
  ADD CONSTRAINT `salary_ibfk_2` FOREIGN KEY (`employee_id`) REFERENCES `employee` (`id`);

ALTER TABLE `employee` ADD `base` FLOAT NULL COMMENT '社保基数' AFTER `position`;
ALTER TABLE `stock` ADD `enable_date` DATE NULL COMMENT '固定资产等折旧起始日期,即物品开始使用的日期' AFTER `out_price`;
ALTER TABLE `cost` CHANGE `subject_2` `subject_2` VARCHAR(512) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL;
ALTER TABLE `purchase` DROP FOREIGN KEY `purchase_ibfk_3`;
ALTER TABLE `purchase` CHANGE `subject_2` `subject_2` VARCHAR(512) NULL DEFAULT NULL;
ALTER TABLE `product` DROP FOREIGN KEY `product_ibfk_3`;
ALTER TABLE `product` CHANGE `subject_2` `subject_2` VARCHAR(512) NULL DEFAULT NULL;

-- 2015年8月19日15:09:11
ALTER TABLE `employee` ADD `departure_date` DATETIME NULL COMMENT '离职日期' AFTER `department_id`;
ALTER TABLE `employee` ADD `status` INT NOT NULL DEFAULT '1' COMMENT '0离职，1正常，2停职，3兼职' ;
ALTER TABLE `reimburse` DROP FOREIGN KEY `reimburse_ibfk_2`;
ALTER TABLE `reimburse` CHANGE `subject` `subject` VARCHAR(512) NULL DEFAULT NULL;
ALTER TABLE `reimburse` CHANGE `subject_2` `subject_2` VARCHAR(512) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL;
ALTER TABLE `product` CHANGE `saled_date` `entry_date` INT(11) NOT NULL COMMENT '销售日期';
ALTER TABLE `product` CHANGE `product` `entry_name` VARCHAR(512) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT '商品名称';
ALTER TABLE `product` ADD `entry_memo` VARCHAR(1024) NULL AFTER `entry_name`;
ALTER TABLE `product` CHANGE `amount` `count` INT(11) NOT NULL;
ALTER TABLE `product`
CHANGE `order_no` `order_no` VARCHAR(16) NOT NULL COMMENT '订单号',
CHANGE `entry_date` `entry_date` VARCHAR(16) NOT NULL COMMENT '销售日期',
CHANGE `count` `count` INT(11) NOT NULL DEFAULT '1';

ALTER TABLE `cash`
ADD `type` VARCHAR(16) NULL DEFAULT NULL COMMENT '类型：采购、销售、工资、报销等' AFTER `order_no`,
ADD `pid` INT NOT NULL COMMENT '采购、销售、报销、工资等' AFTER `type`;
ALTER TABLE `cash` DROP `order`;
ALTER TABLE `cash` ADD `path` VARCHAR(1024) NOT NULL COMMENT '路径' AFTER `tax`;

ALTER TABLE `bank`
ADD `type` VARCHAR(16) NULL DEFAULT NULL COMMENT '类型：采购、销售、工资、报销等' AFTER `order_no`,
ADD `pid` INT NOT NULL COMMENT '采购、销售、报销、工资等' AFTER `type`;
ALTER TABLE `bank` DROP `order`;
ALTER TABLE `bank` ADD `path` VARCHAR(1024) NOT NULL COMMENT '路径' AFTER `tax`;

ALTER TABLE `reimburse` ADD `paid` VARCHAR(1024) NULL COMMENT '已经报销的项目' AFTER `update_time`;

INSERT INTO `subjects` (`sbj_number`, `sbj_name`, `sbj_cat`, `sbj_table`, `has_sub`, `balance_set`, `start_balance`) VALUES
(160101, '电子设备', '1', NULL, 0, 0, 0),
(160102, '办公设备', '1', NULL, 0, 0, 0),
(160103, '运输设备', '1', NULL, 0, 0, 0),
(160104, '生产设备', '1', NULL, 0, 0, 0),
(160105, '房屋建筑物', '1', NULL, 0, 0, 0);
TRUNCATE options;
INSERT INTO `options` (`id`, `entry_subject`, `name`, `support`, `year`, `value`) VALUES
(1, 1701, NULL, NULL, 10, 5),
(2, 1801, NULL, NULL, 5, 5),
(3, 160101, NULL, NULL, 3, 5),
(4, 160102, NULL, NULL, 5, 5),
(5, 160103, NULL, NULL, 4, 5),
(6, 160104, NULL, NULL, 10, 5),
(7, 160105, NULL, NULL, 20, 5);

CREATE TABLE IF NOT EXISTS `preparation` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `order_no` varchar(64) NOT NULL,
  `real_order`  VARCHAR(64) NOT NULL,
  `pid` int(11) NOT NULL COMMENT '现金或银行的id',
  `type` varchar(16) NOT NULL COMMENT '现金或银行',
  `memo` text,
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `status` int(11) NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;

ALTER TABLE `stock` ADD `value_year` INT NULL COMMENT '报销年限' AFTER `create_time`,
ADD `value_rate` INT NULL COMMENT '残值率' AFTER `value_year`;
ALTER TABLE `preparation` ADD `entry_amount` FLOAT NOT NULL AFTER `type`;
ALTER TABLE `stock` CHANGE `worth` `worth` TEXT NULL DEFAULT NULL COMMENT '净值';


-- 2015年9月8日16:57:49

INSERT INTO `subjects` (`sbj_number`, `sbj_name`, `sbj_cat`, `sbj_table`, `has_sub`, `balance_set`, `start_balance`) VALUES
(222103, '城建税', '2', NULL, 0, 0, 0),
(222104, '教育附加税', '2', NULL, 0, 0, 0),
(222105, '地方教育费附加', '2', NULL, 0, 0, 0),
(224105, '河道管理费', '2', NULL, 0, 0, 0);

ALTER TABLE `bank` ADD `relation` TEXT NOT NULL AFTER `tax`;
ALTER TABLE `cash` ADD `relation` TEXT NOT NULL AFTER `tax`;
ALTER TABLE `purchase` ADD `relation` TEXT NOT NULL AFTER `subject_2`;
ALTER TABLE `product` ADD `relation` TEXT NOT NULL AFTER `subject_2`;
ALTER TABLE `reimburse` ADD `relation` TEXT NOT NULL AFTER `subject_2`;

-- 2015年9月11日15:30:19
ALTER TABLE `preparation` ADD `amount_used` FLOAT NOT NULL COMMENT '已使用金额' AFTER `entry_amount`;
ALTER TABLE `preparation` CHANGE `real_order` `real_order` TEXT CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;

-- 2015年9月26日16:06:59
ALTER TABLE `employee` ADD `base_2` FLOAT NOT NULL COMMENT '公积金基数' AFTER `base`;
ALTER TABLE `stock` ADD `model` VARCHAR(64) NULL COMMENT '型号' AFTER `name`;
ALTER TABLE `purchase` ADD `model` VARCHAR(64) NULL COMMENT '型号' AFTER `entry_name`;
ALTER TABLE `stock` CHANGE `value_year` `value_month` INT(11) NULL DEFAULT NULL COMMENT '报销年限';
ALTER TABLE `stock` CHANGE `value_rate` `value_rate` INT(11) NOT NULL DEFAULT '0' COMMENT '残值率';
ALTER TABLE `stock` CHANGE `order_no` `order_no` VARCHAR(16) CHARACTER SET utf8 COLLATE utf8_general_ci NULL COMMENT '采购订单';

-- 2015年10月10日15:22:04
ALTER TABLE `stock` ADD `cost_date` VARCHAR(64) NOT NULL DEFAULT '' COMMENT '成本结转日期' AFTER `cost_role`;
ALTER TABLE `cost` ADD `model` VARCHAR(64) NOT NULL DEFAULT '' AFTER `entry_name`;
ALTER TABLE `cost` ADD `count` FLOAT NOT NULL AFTER `model`;
ALTER TABLE `stock` ADD `department_id` INT NOT NULL COMMENT '所属部门' AFTER `client_id`;

-- 2015年10月27日16:56:36
-- 删除科目
DELETE FROM `subjects` WHERE `sbj_number` in
(1003,1021,1031,1111,1201,1211,1212,1301,1302,1303,1304,1311,1321,1411,1421,1431,1441,1451,1532,1541,1611,1621,1622,1623,1631,1632,1821,
2002,2003,2004,2011,2012,2021,2111,2251,2261,2311,2312,2313,2314,2601,2602,2611,2621,2702);
ALTER TABLE `cash` ADD `name` VARCHAR(512) NOT NULL AFTER `target`;
ALTER TABLE `bank` ADD `name` VARCHAR(512) NOT NULL AFTER `target`;
ALTER TABLE `cash` ADD `department_id` INT NOT NULL AFTER `name`;
ALTER TABLE `bank` ADD `department_id` INT NOT NULL AFTER `name`;
ALTER TABLE `cash` ADD `overworth` float NOT NULL COMMENT '溢价' AFTER `tax`;
ALTER TABLE `bank` ADD `overworth` float NOT NULL COMMENT '溢价' AFTER `tax`;

-- 2015年11月3日15:10:33

ALTER TABLE `stock` CHANGE `status` `status` TINYINT(4) NOT NULL DEFAULT '1' COMMENT '1:正常，2出库，3退货，4报废';
update subjects set sbj_name='待处理财产损益' where sbj_number = '1901';
ALTER TABLE `stock` ADD `status_scrap` INT NOT NULL COMMENT '报废后，是否被卖出变现' ;
ALTER TABLE `bank` ADD `client_id` INT NOT NULL AFTER `name`;
ALTER TABLE `cash` ADD `client_id` INT NOT NULL AFTER `name`;
ALTER TABLE `stock` ADD `date_a` VARCHAR(16) NOT NULL COMMENT '摊销折旧起始日期' AFTER `status_scrap`;

CREATE TABLE IF NOT EXISTS `project_b` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(512) NOT NULL,
  `memo` varchar(1024) NOT NULL,
  `status` int(11) NOT NULL,
  `create_at` varchar(16) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;

CREATE TABLE IF NOT EXISTS `project_long` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(512) NOT NULL,
  `memo` varchar(1024) NOT NULL,
  `status` int(11) NOT NULL,
  `create_at` int(11) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;

-- 2015年12月8日16:42:41
ALTER TABLE `bank` CHANGE `status_id` `status_id` TINYINT(4) NOT NULL DEFAULT '1' COMMENT '1:已经生成凭证 ';

-- 2015年12月10日15:20:56
INSERT INTO `department` ( `name`, `type`, `memo`) VALUES ('管理部门', '2', '管理部门');

-- 2015年12月15日17:08:18

ALTER TABLE `bank` CHANGE `amount` `amount` DECIMAL(12,2) NOT NULL COMMENT '金额';
ALTER TABLE `cash` CHANGE `amount` `amount` DECIMAL(12,2) NOT NULL COMMENT '金额';

-- 2015年12月22日15:32:02
ALTER TABLE `transition` ADD `entry_forward` TINYINT NOT NULL COMMENT '是否已经生成结转凭证' AFTER `entry_settlement`;
ALTER TABLE `employee` CHANGE `base` `base` DECIMAL(12,2) NOT NULL DEFAULT '0' COMMENT '社保基数';
ALTER TABLE `employee` CHANGE `base_2` `base_2` DECIMAL(12,2) NULL DEFAULT '0' COMMENT '公积金基数';

-- 2015年12月29日17:07:34

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Database: `account_test`
--

-- --------------------------------------------------------

--
-- Table structure for table `auth_assignment`
--

CREATE TABLE `auth_assignment` (
  `user` varchar(64) NOT NULL,
  `role` varchar(64) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- --------------------------------------------------------

--
-- Table structure for table `auth_category`
--

CREATE TABLE `auth_category` (
  `id` int(11) NOT NULL,
  `name` varchar(64) NOT NULL,
  `description` varchar(128) DEFAULT NULL,
  `type` int(11) NOT NULL,
  `sort_num` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--
-- Dumping data for table `auth_category`
--

INSERT INTO `auth_category` (`id`, `name`, `description`, `type`, `sort_num`) VALUES
(1, 'condom', '总账模块', 0, 0),
(2, 'bank', '银行模块', 0, 0),
(3, 'cash', '现金模块', 0, 0),
(4, 'report', '报表模块', 0, 0),
(5, 'purchase', '采购模块', 0, 0),
(6, 'product', '销售模块', 0, 0),
(7, 'transition', '凭证管理', 0, 0),
(8, 'stock_1601', '长期资产', 0, 0),
(9, 'employee', '员工模块', 0, 0),
(10, 'permission', '权限设置', 0, 0);

-- --------------------------------------------------------

--
-- Table structure for table `auth_permission`
--

CREATE TABLE `auth_permission` (
  `id` varchar(64) NOT NULL,
  `category` varchar(64) NOT NULL DEFAULT 'controller',
  `name` varchar(64) NOT NULL,
  `description` varchar(128) DEFAULT NULL,
  `form` int(11) NOT NULL DEFAULT '0',
  `options` text,
  `default_value` mediumtext,
  `rule` varchar(64) DEFAULT NULL,
  `sort_num` int(11) NOT NULL DEFAULT '0',
  `sort` int(11) NOT NULL DEFAULT '0'
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--
-- Dumping data for table `auth_permission`
--

INSERT INTO `auth_permission` (`id`, `category`, `name`, `description`, `form`, `options`, `default_value`, `rule`, `sort_num`, `sort`) VALUES
('Bank/delete', 'bank', '删除', '', 0, '', '', '', 3, 0),
('Bank/update', 'bank', '修改', '', 0, '', '', '', 2, 0),
('Cash/delete', 'cash', '删除', '', 0, '', '', '', 3, 0),
('Cash/update', 'cash', '修改', '', 0, '', '', '', 2, 0),
('department', 'employee', '部门管理', NULL, 0, NULL, NULL, NULL, 0, 0),
('employee', 'employee', '员工管理', '', 0, '', '', '', 3, 0),
('option/index', 'condom', '账套信息', '', 0, '', '', '', 0, 0),
('permission', 'permission', '修改权限', '', 0, '', '', '', 0, 0),
('product/delete', 'product', '删除', NULL, 0, NULL, NULL, NULL, 3, 0),
('product/stock', 'product', '成本结转', NULL, 0, NULL, NULL, NULL, 0, 0),
('product/update', 'product', '修改', NULL, 0, NULL, NULL, NULL, 2, 0),
('projectB', 'stock_1601', '在建工程', NULL, 0, NULL, NULL, NULL, 0, 0),
('projectLong', 'stock_1601', '长期待摊管理', NULL, 0, NULL, NULL, NULL, 0, 0),
('purchase/delete', 'purchase', '删除', NULL, 0, NULL, NULL, NULL, 3, 0),
('purchase/update', 'purchase', '修改', NULL, 0, NULL, NULL, NULL, 2, 0),
('report/balance', 'report', '资产负债表', NULL, 0, NULL, NULL, NULL, 0, 0),
('report/client', 'report', '客户表', NULL, 0, NULL, NULL, NULL, 0, 0),
('report/department', 'report', '部门表', NULL, 0, NULL, NULL, NULL, 0, 0),
('report/detail', 'report', '明细表', NULL, 0, NULL, NULL, NULL, 0, 0),
('report/money', 'report', '现金流量表', NULL, 0, NULL, NULL, NULL, 0, 0),
('report/profit', 'report', '损益表', NULL, 0, NULL, NULL, NULL, 0, 0),
('report/subjects', 'report', '科目余额表', NULL, 0, NULL, NULL, NULL, 0, 0),
('report/vendor', 'report', '供应商表', NULL, 0, NULL, NULL, NULL, 0, 0),
('stock/admin1701', 'stock_1601', '无形资产', NULL, 0, NULL, NULL, NULL, 0, 0),
('stock/balance_1601', 'stock_1601', '期初明细', NULL, 0, NULL, NULL, NULL, 0, 0),
('subjects', 'condom', '科目表管理', '', 0, '', '', '', 0, 0),
('subjects/balance', 'condom', '总账期初余额', '', 0, '', '', '', 0, 0),
('Transition/bank', 'bank', '银行导入', '', 0, '', '', '', 1, 0),
('Transition/cash', 'cash', '现金导入', '', 0, '', '', '', 1, 0),
('Transition/listAntiSettlement', 'condom', '反结账', '', 0, '', '', '', 6, 6),
('Transition/listClosing', 'condom', '结账', '', 0, '', '', '', 5, 5),
('Transition/listPost', 'condom', '过账', '', 0, '', '', '', 3, 3),
('Transition/listReorganise', 'transition', '整理凭证', '', 0, '', '', '', 0, 0),
('Transition/listSettlement', 'condom', '期末结转', '', 0, '', '', '', 4, 4),
('transition/printp', 'transition', '打印凭证', NULL, 0, NULL, NULL, NULL, 0, 0),
('Transition/purchase', 'purchase', '导入', '', 0, '', '', '', 1, 0),
('transition/reimburse', 'employee', '员工报销', NULL, 0, NULL, NULL, NULL, 0, 0),
('transition/review', 'transition', '审核凭证', NULL, 0, NULL, NULL, NULL, 0, 0),
('transition/salary', 'employee', '员工工资', NULL, 0, NULL, NULL, NULL, 0, 0),
('Transition/sale', 'product', '导入', '', 0, '', '', '', 1, 0),
('transition/unreview', 'transition', '取消审核', NULL, 0, NULL, NULL, NULL, 0, 0);

-- --------------------------------------------------------

--
-- Table structure for table `auth_relation`
--

CREATE TABLE `auth_relation` (
  `user_id` int(11) NOT NULL,
  `role` varchar(64) NOT NULL,
  `permission` varchar(64) NOT NULL,
  `value` varchar(128) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--
-- Indexes for dumped tables
--

--
-- Indexes for table `auth_assignment`
--
ALTER TABLE `auth_assignment`
  ADD PRIMARY KEY (`user`,`role`);

--
-- Indexes for table `auth_category`
--
ALTER TABLE `auth_category`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `auth_permission`
--
ALTER TABLE `auth_permission`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `auth_relation`
--
ALTER TABLE `auth_relation`
  ADD PRIMARY KEY (`user_id`,`permission`);

--
-- AUTO_INCREMENT for dumped tables
--

--
-- AUTO_INCREMENT for table `auth_category`
--
ALTER TABLE `auth_category`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=11;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;

ALTER TABLE `subjects` CHANGE `sbj_name` `sbj_name` VARCHAR(512) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL;